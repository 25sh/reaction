<template name="coreOrderShippingInvoice">

  <form name="capture">
    <div>
      {{> React component=LineItemsContainer items=items collection="Orders"}}
    </div>

    <div>
      {{> React component=InvoiceContainer invoice=invoice collection="Orders"}}
    </div>

    <div class="reason">
      {{> inlineAlerts placement="coreOrderShippingInvoice"}}
    </div>

    <hr>

    {{#if canMakeAdjustments}}
      <div class="form-group order-summary-form-group">
        <label class="form-control-label reason" for="" data-i18n="cartSubTotals.total">Total</label>
        <div class="amount">
          {{> React (numericInputProps "total" invoice.total false)}}
        </div>
      </div>
    {{else}}
      <div class="order-summary-form-group {{#if paymentCaptured}}bg-success{{/if}}">
        <span class="reason">
          {{#if paymentCaptured}}
            <i class="fa fa-check-circle text-success"></i>
            <strong class="text-success" data-i18n="order.capturedTotal">Captured Total</strong>
          {{else}}
            <strong data-i18n="cartSubTotals.total">Total</strong>
          {{/if}}
        </span>
        <div class="amount">
          {{> React (numericInputProps "total" invoice.total false)}}
        </div>
      </div>
    {{/if}}

    <hr>

    <div class="flex">

      {{#if paymentPendingApproval}}
        <button class="btn btn-info btn-block" type="submit" data-event-action="approveInvoice" data-i18n="order.approveInvoice">Approve</button>
      {{/if}}

      {{#if paymentApproved}}
          <a
            class="btn btn-link"
            href="{{pathFor "dashboard/pdf/orders" id=orderId }}?shipment={{fulfillment._id}}"
            target="_blank"
            data-i18n="app.print">
            Print
          </a>
          <button class="btn btn-success flex-item-fill" type="button" data-event-action="capturePayment" {{capturedDisabled}}>
            <span id="btn-capture-payment" data-i18n="order.capturePayment">Capture Payment</span>
            <i class="fa fa-spinner fa-spin {{#unless isCapturing}}hidden{{/unless}}" id="btn-processing"></i>
          </button>
      {{/if}}
    </div>
  </form>

  {{#if paymentCaptured}}
    <form name="refund">
      <div class="form-group order-summary-form-group">
        <label class="form-control-label reason" for="" data-i18n="order.refundAmount">Refund Amount</label>
        <div class="amount">
          {{> React refundInputProps}}
        </div>
      </div>

      {{#if isFetching}}
        <div class="form-group order-summary-form-group">
          <span class="reason">
            <i class="fa fa-info-circle text-info"></i>
            <strong class="text-info">Loading Refunds</strong>
            <i class="fa fa-spinner fa-spin"></i>
          </span>
        </div>
      {{/if}}

      {{#each refund in refunds}}
      <div class="order-summary-form-group">
        <span class="reason" data-i18n="cartSubTotals.refundAmount">Refunded on: {{dateFormat refund.created format="MMM D, YYYY"}}</span>
        <div class="amount">-{{formatPrice refund.amount}}</div>
      </div>
      {{/each}}

      <div class="reason">
        {{> inlineAlerts placement="coreOrderRefund"}}
      </div>

      <hr>

      <div class="order-summary-form-group">
        <span class="reason text-danger">
          <i class="fa fa-minus-circle"></i>
          <strong data-i18n="order.adjustedTotal">Adjusted Total</strong>
        </span>
        <div class="amount text-danger">
          <strong>{{formatPrice adjustedTotal}}</strong>
        </div>
      </div>
      <hr>
      <div class="flex">
        <a
          class="btn btn-link"
          href="{{pathFor "dashboard/pdf/orders" id=orderId }}?shipment={{fulfillment._id}}"
          target="_blank"
          data-i18n="app.printInvoice">
          Print Invoice
        </a>
        <button
          class="btn btn-success flex-item-fill"
          type="submit"
          data-event-action="applyRefund"
          {{refundSubmitDisabled}}
        >
          <span id="btn-refund-payment" data-i18n="order.applyRefund">Apply Refund</span>
          <i class="fa fa-spinner fa-spin {{#unless isRefunding}}hidden{{/unless}}"></i>
        </button>
      </div>
    </form>
  {{else}}

  {{/if}}

</template>
